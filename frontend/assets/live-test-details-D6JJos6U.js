import{r as f,l as h,u as J,i as Q,h as X,f as S,p as y,b as j,y as m,j as s,a as D,I as ee,R as se}from"./index-Dz0BP38o.js";import{R as ne,C as oe}from"./ResponsiveMover-xQSJrE03.js";var R={},z={};Object.defineProperty(z,"__esModule",{value:!0});class ae{constructor(a){this.instance=void 0,this.options=a,typeof window<"u"&&(this.instance=new window.Razorpay(this.options))}on(a,c){if(!this.instance)throw new Error("Razorpay Instance in not ready");this.instance.on(a,c)}open(){if(!this.instance)throw new Error("Razorpay Instance in not ready");this.instance.open()}}z.default=ae;var te=h&&h.__createBinding||(Object.create?function(n,a,c,t){t===void 0&&(t=c);var e=Object.getOwnPropertyDescriptor(a,c);(!e||("get"in e?!a.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return a[c]}}),Object.defineProperty(n,t,e)}:function(n,a,c,t){t===void 0&&(t=c),n[t]=a[c]}),ce=h&&h.__setModuleDefault||(Object.create?function(n,a){Object.defineProperty(n,"default",{enumerable:!0,value:a})}:function(n,a){n.default=a}),re=h&&h.__importStar||function(n){if(n&&n.__esModule)return n;var a={};if(n!=null)for(var c in n)c!=="default"&&Object.prototype.hasOwnProperty.call(n,c)&&te(a,n,c);return ce(a,n),a},le=h&&h.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(R,"__esModule",{value:!0});var E=R.useRazorpay=void 0;const P=re(f),ie=le(z),de=()=>{const[n,a]=P.useState(!1),[c,t]=P.useState(),e=typeof window<"u",_=()=>!(!e||!("Razorpay"in window));function p(u){return new Promise((v,l)=>{const g=window.document.createElement("script");g.src=u,g.onload=function(){v()},g.onerror=function(b){l(b.toString())},document.body.appendChild(g)})}return P.useEffect(()=>{e&&(a(!0),_()||p("https://checkout.razorpay.com/v1/checkout.js").then(()=>{t(void 0)}).catch(u=>{u instanceof Error?t(u.message):t("Unknown Error")}).finally(()=>a(!1)))},[]),{error:c,isLoading:n,Razorpay:ie.default}};E=R.useRazorpay=de;const pe=()=>{const[n,a]=f.useState(!1),[c,t]=f.useState(!1),[e,_]=f.useState(""),{token:p,logout:u,isLogin:v,userDetails:l}=J(),[g,b]=f.useState([]),[x,w]=f.useState(""),[A,I]=f.useState(!1),{Razorpay:O}=E(),{openLogin:C}=Q(),T=X(),{id:G}=S(),k=atob(G||"");f.useEffect(()=>{B()},[]);const B=async()=>{t(!0);try{const o=await y(j.liveTestDetails,{test_id:k},p,u);_(o.data)}catch(o){console.error("Error fetching test series:",o),m.error((o==null?void 0:o.message)||"Something went wrong!")}finally{t(!1)}},F=()=>{t(!0),y(j.couponList,{user_id:l==null?void 0:l.id,type:"live-test"},p,u).then(o=>{const{success:d,data:r}=o;d?b(r):m.error(r)}).catch(o=>console.log(o)).finally(()=>{t(!1)})},L=o=>{if(!o)return m.error("Please select coupon code!"),!1;t(!0),w(o);const d={coupon_for:"live-test",coupon_code:o,course_id:e==null?void 0:e.id};y(j.applyCouponApi,d,p,u).then(r=>{const{status:i,message:N}=r;if(i){const{real_amount:V,discount_amount:$,gst_amount:W,total_amount:Y,message:Z}=r;_(q=>({...q,offer_price:V,discount_amount:$,gst_amount:W,total_amount:Y})),a(!1),m.success(Z),I(!1)}else m.error(N)}).catch(r=>console.log(r)).finally(()=>{t(!1)})},H=()=>{if(!x){m.error("No coupon to remove!");return}t(!0);const o={coupon_for:"test",coupon_code:x,course_id:e==null?void 0:e.id,remove:1};y(j.applyCouponApi,o,p,u).then(d=>{const{status:r,message:i}=d;r?(_(N=>({...N,offer_price:e==null?void 0:e.price,discount_amount:0,gst_amount:0,total_amount:e==null?void 0:e.price})),m.success("Coupon removed successfully"),w(""),I(!0)):m.error(i||"Failed to remove coupon")}).catch(d=>console.error(d)).finally(()=>{t(!1)})},M=o=>{if(!v)return C(),!1;t(!0);const d={order_type:"live-test",test_id:e==null?void 0:e.id,transaction_id:o,payment_type:"online",payment_status:"pending",coupon_code:x};y(j.buyLiveTest,d,p,u).then(r=>{const{success:i,message:N}=r;i?T("/dashboard"):m.error(N)}).catch(r=>console.log(r)).finally(()=>{t(!1)})},K=o=>{const d={key:se,amount:e==null?void 0:e.total_amount,currency:"INR",name:"Live Test",description:e==null?void 0:e.name,order_id:o,handler:i=>{console.log(i),M(i==null?void 0:i.razorpay_payment_id)},prefill:{name:l==null?void 0:l.name,email:l==null?void 0:l.email,contact:l==null?void 0:l.mobileNumber},theme:{color:"#ff693d"}};new O(d).open()},U=()=>{if(!v)return C(),!1;if((e==null?void 0:e.total_amount)===0){M("free-course-transaction");return}t(!0),y(j.createRazorPay,{amount:e==null?void 0:e.total_amount},p,u).then(o=>{const{success:d,message:r,order:i}=o;d?K(i==null?void 0:i.id):m.error(r)}).catch(o=>console.log(o)).finally(()=>{t(!1)})};return s.jsxs(s.Fragment,{children:[s.jsx(D,{visible:c}),s.jsx(ne,{}),s.jsxs("div",{children:[s.jsx("div",{className:"course-details-page pb-0 testseries-details-page",children:s.jsx("div",{className:"container",children:s.jsxs("div",{className:"row justify-content-between",children:[s.jsx("div",{className:"col-lg-7 col-xxl-8 mb-4",children:s.jsxs("div",{className:"course-details-left-section",children:[s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-lg-12 col-md-6 mb-4 mb-lg-0",children:[s.jsx("div",{className:"details-top-badge test-detail-badge",children:s.jsxs("span",{className:"corse-cate-badge",children:["Category: ",e==null?void 0:e.category_name," "]})}),s.jsxs("h1",{className:"course-detail-heading testseries-details-heading",children:[s.jsx("img",{src:e!=null&&e.image?`${ee}${e==null?void 0:e.details_image}`:"/assets/img/no_image.jpg",alt:"#",className:"img-fluid"})," ",e==null?void 0:e.test_name]})]}),s.jsx("div",{className:"col-lg-12 col-md-6 mb-4 mb-lg-0",children:s.jsx("div",{className:"course-card-details-move"})})]}),s.jsxs("div",{className:"course-details-content-card",id:"Details",children:[s.jsx("h2",{className:"sub-heading",children:"Know Details Test"}),s.jsx("p",{className:"course-details-context",dangerouslySetInnerHTML:{__html:e==null?void 0:e.description}})]})]})}),s.jsx("div",{className:"col-lg-5 col-xxl-4 mb-4",children:s.jsx("div",{className:"course-card-details-movers",children:s.jsxs("div",{className:"course-details-right-card",children:[s.jsxs("p",{className:"course-price details-page-price",children:[s.jsxs("span",{className:"mrp-price",children:["₹ ",e==null?void 0:e.price]}),"₹",e==null?void 0:e.offer_price]}),s.jsxs("div",{className:"course-cart-detail-card",children:[s.jsx("h4",{children:"Payment Details"}),s.jsx("table",{children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"text",children:"Price"}),s.jsxs("td",{className:"text-end",children:["₹ ",e==null?void 0:e.offer_price]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"text",children:"Discount "}),s.jsxs("td",{className:"text-primery text-end",children:["- ₹ ",e==null?void 0:e.discount_amount]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"text",children:"GST Amount"}),s.jsxs("td",{className:"text-end",children:["₹ ",e==null?void 0:e.gst_amount]})]}),s.jsxs("tr",{children:[s.jsx("th",{className:"text",children:"Total Payable Amount"}),s.jsxs("th",{className:"text-end",children:["₹ ",e==null?void 0:e.total_amount]})]})]})}),s.jsx("div",{className:"cart-action-btn",children:s.jsxs("a",{onClick:U,href:"#",className:"pay-now-btn btn",children:["Pay Now ₹ ",e==null?void 0:e.total_amount]})}),s.jsxs("div",{className:"apply-coupon-card-input",children:[s.jsxs("div",{className:"apply-coupon-inputs-align",children:[s.jsx("img",{src:"/assets/img/discount.svg",alt:"Discount Icon",className:"img-fluid"}),s.jsx("input",{value:x,type:"text",placeholder:"Enter Coupon Code",className:"form-control",onChange:o=>w(o.target.value),disabled:!A}),x&&!A?s.jsxs("button",{type:"button",className:"remove-coupon-btn",onClick:H,children:[s.jsx("i",{className:"fa fa-times"})," "]}):s.jsx("button",{type:"button",className:"apply-coupon-btn",onClick:()=>L(x),children:"Apply"})]}),s.jsxs("button",{onClick:()=>{v?(F(),a(!0)):C()},className:"prdt-modal-open",type:"button",children:["View Coupon Code"," ",s.jsx("i",{className:"fa-solid fa-angle-right"})]})]}),s.jsxs("div",{className:"course-right-footer-sec d-none d-lg-block",children:[s.jsxs("div",{className:"pay-throw-images",children:[s.jsx("img",{src:"/assets/img/Visa.png",alt:"#",className:"trans-img"}),s.jsx("img",{src:"/assets/img/Mastercard.png",alt:"#",className:"trans-img"}),s.jsx("img",{src:"/assets/img/PayPal.png",alt:"#",className:"trans-img"}),s.jsx("img",{src:"/assets/img/GooglePay.png",alt:"#",className:"trans-img"}),s.jsx("img",{src:"/assets/img/GooglePay-1.png",alt:"#",className:"trans-img"})]}),s.jsx("div",{className:"note-cart-items",children:s.jsx("p",{className:"text-center",children:"Safe and secure payment | 100% Authentic resources"})})]})]})]})})})]})})}),s.jsx(oe,{show:n,onClose:()=>a(!1),onApply:L,coupons:g,loading:c})]})]})};export{pe as default};
