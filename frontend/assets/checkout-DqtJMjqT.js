import{i as H,r as o,u as O,p as i,b as m,y as a,j as e,a as W,I as q}from"./index-Dj8vARCT.js";import{l as z}from"./script.esm-BJ5QgV6L.js";const V=()=>{const{openLogin:S}=H(),[_,r]=o.useState(!1),{token:l,logout:d,isLogin:L}=O(),[u,A]=o.useState(""),[C,k]=o.useState(!0),[D,E]=o.useState([]),[p,F]=o.useState([]),[j,y]=o.useState(0),[w,N]=o.useState(0),[c,g]=o.useState({first_name:"",last_name:"",address:"",pincode:"",state:"",city:""});o.useEffect(()=>{I(),b()},[]);const I=async()=>{r(!0);try{const s=await i(m.cartList,{},l,d);s.success&&(E(s.data||[]),N(s.subTotal||0),y(s.total_amount||0))}catch{a.error("Error fetching cart")}finally{r(!1)}},b=async()=>{r(!0);try{const s=await i(m.addressList,{},l,d);s.success&&F(s.data||[])}catch{a.error("Error fetching cart")}finally{r(!1)}},T=async()=>{if(!u)return a.error("Please enter a coupon code");r(!0);try{const s=await i(m.applyCartCouponApi,{coupon_code:u},l,d),{status:t,message:n,real_amount:f,total_amount:v}=s;t?(N(f),y(v),k(!1),a.success(n||"Coupon applied")):a.error(n||"Invalid coupon")}catch{a.error("Failed to apply coupon")}finally{r(!1)}},P=async()=>{if(!u)return a.error("No coupon to remove");r(!0);try{const s=await i(m.applyCartCouponApi,{coupon_code:u,remove:1},l,d);s.status?(N(s.real_amount||0),y(s.total_amount||0),A(""),k(!0),a.success(s.message||"Coupon removed")):a.error(s.message||"Failed to remove coupon")}catch{a.error("Error removing coupon")}finally{r(!1)}},M=async()=>{if(!L)return S();r(!0);try{const s={coupon_code:u||""},t=await i(m.buyCartItemsCashFree1,s,l,d),{success:n,payment_session_id:f,message:v}=t;if(console.log(n),!n){a.error(v||"Failed to create order");return}n&&(await z({mode:"production"})).checkout({paymentSessionId:f,redirectTarget:"_self"})}catch(s){console.error(s),a.error("An error occurred while creating order")}finally{r(!1)}},R=async s=>{r(!0);try{(await i(m.setDefaultAddress,{address_id:s},l,d)).success?(b(),a.success("Default address updated!")):a.error("Failed to update default address")}catch(t){a.error("Error setting default address"),console.error(t)}finally{r(!1)}},[$,x]=o.useState(!1),h=s=>{const{name:t,value:n}=s.target;g(f=>({...f,[t]:n}))},U=async()=>{try{const s={...c};c.id&&(s.address_id=c.id);const t=await i(m.addAddress,s,l,d);t.success?(b(),x(!1),g({first_name:"",last_name:"",address:"",state:"",city:"",pincode:""}),a.success(c.id?"Address updated successfully!":"Address added successfully!")):a.error(t.message||"Failed to add address")}catch(s){console.error(s),a.error("Error adding address")}},B=async s=>{if(window.confirm("Are you sure you want to delete this address?")){r(!0);try{const t=await i(m.deleteAddress,{address_id:s},l,d);t.success?(b(),a.success("Address deleted successfully!")):a.error(t.message||"Failed to delete address")}catch(t){console.error(t),a.error("Error deleting address")}finally{r(!1)}}},G=s=>{const t=p.find(n=>n.id===s);t&&(g({id:t.id,first_name:t.first_name,last_name:t.last_name,address:t.address,state:t.state,city:t.city,pincode:t.pincode}),x(!0))};return e.jsxs(e.Fragment,{children:[e.jsx(W,{visible:_}),e.jsx("section",{children:e.jsx("div",{className:"checkout-page",children:e.jsx("div",{className:"container",children:e.jsxs("div",{className:"row",children:[e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"checkout-form",children:[e.jsx("button",{className:"btn btn-primary mb-3",onClick:()=>x(!0),children:"Add New Address"}),e.jsx("h2",{className:"checkout-heading mb-4",children:"Delivery Address"}),!_&&p.length===0&&e.jsx("p",{className:"text-center text-muted",children:"No addresses found."}),p.map(s=>e.jsx("div",{className:"mb-3",children:e.jsx("div",{className:"card h-100 shadow-sm address-card",children:e.jsxs("div",{className:"card-body d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsxs("h5",{className:"card-title",children:[s.first_name," ",s.last_name," ",s.is_default===1&&e.jsx("span",{className:"badge bg-primary",children:"Default"})]}),e.jsx("p",{className:"card-text mb-1",children:s.address}),e.jsxs("p",{className:"card-text mb-1",children:[s.city,", ",s.state," - ",s.pincode]})]}),e.jsxs("div",{className:"d-flex flex-column gap-2",children:[e.jsx("button",{className:"btn btn-sm btn-warning",onClick:()=>G(s.id),children:"Edit"}),!s.is_default&&e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>B(s.id),children:"Delete"}),s.is_default!==1&&e.jsx("button",{className:"btn btn-sm btn-primary",onClick:()=>R(s.id),children:"Set Default"})]})]})})},s.id))]})}),e.jsx("div",{className:"col-md-6 mb-4",children:e.jsxs("div",{className:"checkout-right-card",children:[e.jsx("ul",{className:"cart-items-listing",children:D.map(s=>e.jsx("li",{children:e.jsxs("div",{className:"cart-item text-decoration-none d-flex",children:[e.jsx("div",{className:"cart-item-image me-3",children:e.jsx("img",{src:`${q}${s==null?void 0:s.image}`,alt:s.book_name,className:"img-fluid"})}),e.jsxs("div",{className:"cart-item-details",children:[e.jsx("h4",{className:"product-name",children:s.book_name}),e.jsx("div",{className:"cart-item-btm",children:e.jsxs("p",{className:"course-price cart-item-price",children:["₹",s.item_price,s.book_price&&s.offer_price&&s.offer_price<s.book_price&&e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"mrp-price ms-2",style:{textDecoration:"line-through",color:"#888"},children:["₹",s.book_price]}),e.jsxs("span",{className:"discount-price ms-2 text-success",children:[Math.round((s.book_price-s.offer_price)/s.book_price*100),"% off"]})]})]})})]})]})},s.id))}),e.jsx("div",{className:"checkout-table mt-3",children:e.jsx("table",{className:"table table-borderless",children:e.jsxs("tbody",{children:[e.jsxs("tr",{children:[e.jsx("td",{children:"Subtotal"}),e.jsxs("td",{className:"text-end",children:["₹",w]})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Shipping"}),e.jsx("td",{className:"text-end",children:"₹0"})]}),e.jsxs("tr",{children:[e.jsx("td",{children:"Discount"}),e.jsxs("td",{className:"text-end",children:["₹",w-j]})]}),e.jsxs("tr",{children:[e.jsx("th",{children:"Total"}),e.jsxs("th",{className:"text-end",children:["₹",j]})]})]})})}),e.jsx("div",{className:"checkout-action-btn mt-3",children:e.jsxs("a",{className:`btn course-action-btn-prime w-100 ${p.some(s=>s.is_default===1)?"":"disabled"}`,onClick:()=>{if(!p.some(s=>s.is_default===1)){a.error("Please select a default address first");return}M()},children:["Pay Now ₹ ",j]})}),e.jsxs("div",{className:"checkout-discount-coupon d-flex mt-3",children:[e.jsx("input",{type:"text",name:"discountCode",className:"form-control w-100 me-3",placeholder:"Discount Code",value:u,onChange:s=>A(s.target.value),disabled:!C}),C?e.jsx("button",{className:"btn checkout-discount-btn",onClick:T,children:"Apply"}):e.jsx("button",{className:"btn btn-danger",onClick:P,children:"Remove"})]})]})})]})})})}),$&&e.jsx("div",{className:"modal show d-block",tabIndex:-1,children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h5",{className:"modal-title",children:"Add New Address"}),e.jsx("button",{type:"button",className:"btn-close",onClick:()=>x(!1)})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"First Name",name:"first_name",value:c.first_name,onChange:h}),e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"Last Name",name:"last_name",value:c.last_name,onChange:h}),e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"Address",name:"address",value:c.address,onChange:h}),e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"State",name:"state",value:c.state,onChange:h}),e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"City",name:"city",value:c.city,onChange:h}),e.jsx("input",{type:"text",className:"form-control mb-2",placeholder:"Pincode",name:"pincode",value:c.pincode,onChange:h})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>x(!1),children:"Close"}),e.jsx("button",{type:"button",className:"btn btn-primary",onClick:U,children:c.id?"Update Address":"Save Address"})]})]})})})]})};export{V as default};
