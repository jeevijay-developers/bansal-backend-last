import{l as h,r as f,u as Q,i as X,h as S,f as D,p as y,b as j,y as m,j as s,a as ee,I as se,R as ne}from"./index-C28FCJwv.js";import{R as oe,C as ae}from"./ResponsiveMover-oWxHKwto.js";var z={},A={};Object.defineProperty(A,"__esModule",{value:!0});class te{constructor(a){this.instance=void 0,this.options=a,typeof window<"u"&&(this.instance=new window.Razorpay(this.options))}on(a,c){if(!this.instance)throw new Error("Razorpay Instance in not ready");this.instance.on(a,c)}open(){if(!this.instance)throw new Error("Razorpay Instance in not ready");this.instance.open()}}A.default=te;var ce=h&&h.__createBinding||(Object.create?function(n,a,c,t){t===void 0&&(t=c);var e=Object.getOwnPropertyDescriptor(a,c);(!e||("get"in e?!a.__esModule:e.writable||e.configurable))&&(e={enumerable:!0,get:function(){return a[c]}}),Object.defineProperty(n,t,e)}:function(n,a,c,t){t===void 0&&(t=c),n[t]=a[c]}),re=h&&h.__setModuleDefault||(Object.create?function(n,a){Object.defineProperty(n,"default",{enumerable:!0,value:a})}:function(n,a){n.default=a}),le=h&&h.__importStar||function(n){if(n&&n.__esModule)return n;var a={};if(n!=null)for(var c in n)c!=="default"&&Object.prototype.hasOwnProperty.call(n,c)&&ce(a,n,c);return re(a,n),a},ie=h&&h.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(z,"__esModule",{value:!0});var O=z.useRazorpay=void 0;const R=le(f),de=ie(A),b=(n,...a)=>{},ue=()=>{const[n,a]=R.useState(!1),[c,t]=R.useState(),e=typeof window<"u",_=()=>!(!e||!("Razorpay"in window));function p(u){return new Promise((v,l)=>{const g=window.document.createElement("script");g.src=u,g.onload=function(){v()},g.onerror=function(w){l(w.toString())},document.body.appendChild(g)})}return R.useEffect(()=>{if(b(),!e){b();return}a(!0),_()||(b(),p("https://checkout.razorpay.com/v1/checkout.js").then(()=>{b(),t(void 0)}).catch(u=>{b("script loading error",u),u instanceof Error?t(u.message):t("Unknown Error")}).finally(()=>a(!1)))},[]),{error:c,isLoading:n,Razorpay:de.default}};O=z.useRazorpay=ue;const fe=()=>{const[n,a]=f.useState(!1),[c,t]=f.useState(!1),[e,_]=f.useState(""),{token:p,logout:u,isLogin:v,userDetails:l}=Q(),[g,w]=f.useState([]),[x,C]=f.useState(""),[I,L]=f.useState(!1),{Razorpay:T}=O(),{openLogin:P}=X(),G=S(),{id:k}=D(),B=atob(k||"");f.useEffect(()=>{F()},[]);const F=async()=>{t(!0);try{const o=await y(j.liveTestDetails,{test_id:B},p,u);_(o.data)}catch(o){console.error("Error fetching test series:",o),m.error((o==null?void 0:o.message)||"Something went wrong!")}finally{t(!1)}},H=()=>{t(!0),y(j.couponList,{user_id:l==null?void 0:l.id,type:"live-test"},p,u).then(o=>{const{success:d,data:r}=o;d?w(r):m.error(r)}).catch(o=>console.log(o)).finally(()=>{t(!1)})},M=o=>{if(!o)return m.error("Please select coupon code!"),!1;t(!0),C(o);const d={coupon_for:"live-test",coupon_code:o,course_id:e==null?void 0:e.id};y(j.applyCouponApi,d,p,u).then(r=>{const{status:i,message:N}=r;if(i){const{real_amount:$,discount_amount:W,gst_amount:Y,total_amount:Z,message:q}=r;_(J=>({...J,offer_price:$,discount_amount:W,gst_amount:Y,total_amount:Z})),a(!1),m.success(q),L(!1)}else m.error(N)}).catch(r=>console.log(r)).finally(()=>{t(!1)})},K=()=>{if(!x){m.error("No coupon to remove!");return}t(!0);const o={coupon_for:"test",coupon_code:x,course_id:e==null?void 0:e.id,remove:1};y(j.applyCouponApi,o,p,u).then(d=>{const{status:r,message:i}=d;r?(_(N=>({...N,offer_price:e==null?void 0:e.price,discount_amount:0,gst_amount:0,total_amount:e==null?void 0:e.price})),m.success("Coupon removed successfully"),C(""),L(!0)):m.error(i||"Failed to remove coupon")}).catch(d=>console.error(d)).finally(()=>{t(!1)})},E=o=>{if(!v)return P(),!1;t(!0);const d={order_type:"live-test",test_id:e==null?void 0:e.id,transaction_id:o,payment_type:"online",payment_status:"pending",coupon_code:x};y(j.buyLiveTest,d,p,u).then(r=>{const{success:i,message:N}=r;i?G("/dashboard"):m.error(N)}).catch(r=>console.log(r)).finally(()=>{t(!1)})},U=o=>{const d={key:ne,amount:e==null?void 0:e.total_amount,currency:"INR",name:"Live Test",description:e==null?void 0:e.name,order_id:o,handler:i=>{console.log(i),E(i==null?void 0:i.razorpay_payment_id)},prefill:{name:l==null?void 0:l.name,email:l==null?void 0:l.email,contact:l==null?void 0:l.mobileNumber},theme:{color:"#ff693d"}};new T(d).open()},V=()=>{if(!v)return P(),!1;if((e==null?void 0:e.total_amount)===0){E("free-course-transaction");return}t(!0),y(j.createRazorPay,{amount:e==null?void 0:e.total_amount},p,u).then(o=>{const{success:d,message:r,order:i}=o;d?U(i==null?void 0:i.id):m.error(r)}).catch(o=>console.log(o)).finally(()=>{t(!1)})};return s.jsxs(s.Fragment,{children:[s.jsx(ee,{visible:c}),s.jsx(oe,{}),s.jsxs("div",{children:[s.jsx("div",{className:"course-details-page pb-0 testseries-details-page",children:s.jsx("div",{className:"container",children:s.jsxs("div",{className:"row justify-content-between",children:[s.jsx("div",{className:"col-lg-7 col-xxl-8 mb-4",children:s.jsxs("div",{className:"course-details-left-section",children:[s.jsxs("div",{className:"row",children:[s.jsxs("div",{className:"col-lg-12 col-md-6 mb-4 mb-lg-0",children:[s.jsx("div",{className:"details-top-badge test-detail-badge",children:s.jsxs("span",{className:"corse-cate-badge",children:["Category: ",e==null?void 0:e.category_name," "]})}),s.jsxs("h1",{className:"course-detail-heading testseries-details-heading",children:[s.jsx("img",{src:e!=null&&e.image?`${se}${e==null?void 0:e.details_image}`:"/assets/img/no_image.jpg",alt:"#",className:"img-fluid"})," ",e==null?void 0:e.test_name]})]}),s.jsx("div",{className:"col-lg-12 col-md-6 mb-4 mb-lg-0",children:s.jsx("div",{className:"course-card-details-move"})})]}),s.jsxs("div",{className:"course-details-content-card",id:"Details",children:[s.jsx("h2",{className:"sub-heading",children:"Know Details Test"}),s.jsx("p",{className:"course-details-context",dangerouslySetInnerHTML:{__html:e==null?void 0:e.description}})]})]})}),s.jsx("div",{className:"col-lg-5 col-xxl-4 mb-4",children:s.jsx("div",{className:"course-card-details-movers",children:s.jsxs("div",{className:"course-details-right-card",children:[s.jsxs("p",{className:"course-price details-page-price",children:[s.jsxs("span",{className:"mrp-price",children:["₹ ",e==null?void 0:e.price]}),"₹",e==null?void 0:e.offer_price]}),s.jsxs("div",{className:"course-cart-detail-card",children:[s.jsx("h4",{children:"Payment Details"}),s.jsx("table",{children:s.jsxs("tbody",{children:[s.jsxs("tr",{children:[s.jsx("td",{className:"text",children:"Price"}),s.jsxs("td",{className:"text-end",children:["₹ ",e==null?void 0:e.offer_price]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"text",children:"Discount "}),s.jsxs("td",{className:"text-primery text-end",children:["- ₹ ",e==null?void 0:e.discount_amount]})]}),s.jsxs("tr",{children:[s.jsx("td",{className:"text",children:"GST Amount"}),s.jsxs("td",{className:"text-end",children:["₹ ",e==null?void 0:e.gst_amount]})]}),s.jsxs("tr",{children:[s.jsx("th",{className:"text",children:"Total Payable Amount"}),s.jsxs("th",{className:"text-end",children:["₹ ",e==null?void 0:e.total_amount]})]})]})}),s.jsx("div",{className:"cart-action-btn",children:s.jsxs("a",{onClick:V,href:"#",className:"pay-now-btn btn",children:["Pay Now ₹ ",e==null?void 0:e.total_amount]})}),s.jsxs("div",{className:"apply-coupon-card-input",children:[s.jsxs("div",{className:"apply-coupon-inputs-align",children:[s.jsx("img",{src:"/assets/img/discount.svg",alt:"Discount Icon",className:"img-fluid"}),s.jsx("input",{value:x,type:"text",placeholder:"Enter Coupon Code",className:"form-control",onChange:o=>C(o.target.value),disabled:!I}),x&&!I?s.jsxs("button",{type:"button",className:"remove-coupon-btn",onClick:K,children:[s.jsx("i",{className:"fa fa-times"})," "]}):s.jsx("button",{type:"button",className:"apply-coupon-btn",onClick:()=>M(x),children:"Apply"})]}),s.jsxs("button",{onClick:()=>{v?(H(),a(!0)):P()},className:"prdt-modal-open",type:"button",children:["View Coupon Code"," ",s.jsx("i",{className:"fa-solid fa-angle-right"})]})]}),s.jsxs("div",{className:"course-right-footer-sec d-none d-lg-block",children:[s.jsxs("div",{className:"pay-throw-images",children:[s.jsx("img",{src:"/assets/img/Visa.png",alt:"#",className:"trans-img"}),s.jsx("img",{src:"/assets/img/Mastercard.png",alt:"#",className:"trans-img"}),s.jsx("img",{src:"/assets/img/PayPal.png",alt:"#",className:"trans-img"}),s.jsx("img",{src:"/assets/img/GooglePay.png",alt:"#",className:"trans-img"}),s.jsx("img",{src:"/assets/img/GooglePay-1.png",alt:"#",className:"trans-img"})]}),s.jsx("div",{className:"note-cart-items",children:s.jsx("p",{className:"text-center",children:"Safe and secure payment | 100% Authentic resources"})})]})]})]})})})]})})}),s.jsx(ae,{show:n,onClose:()=>a(!1),onApply:M,coupons:g,loading:c})]})]})};export{fe as default};
